# feat-006: Multi Viewの8カメラ対応

## Status: Closed (2026-02-12)

## Summary

本番アプリのMulti View（Tab 3）を4カメラから最大8カメラに拡張する。Live ViewとPTP同期録画の両方を8カメラに対応させる。

## Background

現状の本番アプリはMulti View（Tab 3）でカメラ同時4台の仕様となっている。これを8台まで対応可能にする。8台全てのカメラが使われなくても、Live ViewとPTP同期録画に支障がないようにする。

## Scope

- Live Viewのプレビュースロットを4から最大8に拡張
- PTP同期録画を最大8カメラに対応
- 8台未満のカメラ構成でもLive View・録画が正常に動作すること
- 対象: Multi View（Tab 3）のみ

## Steps

### Step 1: 要件定義・設計

- 要求仕様書の作成
- 機能設計書の作成

### Step 2: 実装 — 完了

- プレビューレイアウトの8スロット対応
- 録画制御の8カメラ対応
- カメラ未使用時の正常動作

### Step 3: テスト — 完了

#### テスト3-1: 8カメラ × 200秒 → T5 EVO — FAIL

| 条件 | 値 |
|------|-----|
| カメラ台数 | 8 |
| 解像度 | 1920x1080 |
| フレームレート | 30 fps |
| PixelFormat | BayerGR8 |
| 出力形式 | Raw |
| 録画時間 | 200秒 |
| 保存先 | T5 EVO (sdb) |

**結果**: 約5000フレーム（約167秒）を超えたあたりからフレーム落ちが頻発。原因はストレージ帯域不足（Step 4参照）。

### Step 4: フレーム落ち原因調査 — 完了（原因特定）

**原因**: T5 EVOの実効書き込み速度（~430 MB/s）に対して、8カメラRawデータレート（~497 MB/s）が恒常的に超過。差分がOSバッファに蓄積し、約167秒後にバッファ飽和でフレームドロップ発生。

詳細は [investigation.md](investigation.md) を参照。

### Step 5: 検証テスト — 完了（PASS）

8カメラ × 200秒 Raw録画 → nvme0n1

- フレーム落ち: なし
- s13_raw_tool.py validate: 全カメラ正常
- 同期確認: 0フレーム目・6000フレーム目で全カメラ同一映像を確認

→ ストレージ帯域が原因であることを確定

### Step 6: 長時間録画テスト — 完了（PASS）

6カメラ × 3600秒 Raw録画 → T5 EVO

- フレーム落ち: なし
- s13_raw_tool.py validate: 全カメラ正常
- 同期確認: 0フレーム目・108000フレーム目で全カメラ同一映像を確認

### 運用方針

- アプリの設定上は8台録画可能な状態を維持
- T5 EVOでの運用時は6台まで（~373 MB/s < 430 MB/s）
- 将来的に複数ディスク分散を検討する可能性あり

## Related Documents

- [feat-005](../feat-005-6cam-channel-manager/) - Channel Managerの6カメラ対応（対応不要でクローズ）
- [investigation.md](investigation.md) - フレーム落ち原因調査メモ
